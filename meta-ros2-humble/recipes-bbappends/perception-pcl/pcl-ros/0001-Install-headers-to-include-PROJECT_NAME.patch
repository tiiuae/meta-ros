From 6b2349be1497b8b1b4b06eb4c3495957ce32311b Mon Sep 17 00:00:00 2001
From: Mehmet Killioglu <mehmet.killioglu@unikie.com>
Date: Mon, 5 Jun 2023 12:22:14 +0300
Subject: [PATCH] Install headers to include/PROJECT_NAME

---
 CMakeLists.txt | 22 +++++++++++-----------
 1 file changed, 11 insertions(+), 11 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 7340c7c..88cce2d 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -10,11 +10,12 @@ endif()
 
 ## Find system dependencies
 find_package(Eigen3 REQUIRED)
-find_package(PCL REQUIRED QUIET COMPONENTS core features filters io segmentation surface)
+find_package(PCL REQUIRED QUIET COMPONENTS common features filters io segmentation surface)
 
 ## Find ROS package dependencies
 find_package(ament_cmake REQUIRED)
 find_package(pcl_conversions REQUIRED)
+find_package(PkgConfig REQUIRED)
 find_package(rclcpp REQUIRED)
 find_package(sensor_msgs REQUIRED)
 find_package(geometry_msgs REQUIRED)
@@ -34,17 +35,16 @@ set(dependencies
   PCL
 )
 
-include_directories(
-  include
-  ${PCL_INCLUDE_DIRS}
-)
 
 ## Declare the pcl_ros_tf library
 add_library(pcl_ros_tf src/transforms.cpp)
+target_include_directories(pcl_ros_tf PUBLIC
+    $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include>
+    $<INSTALL_INTERFACE:include/${PROJECT_NAME}>
+)
 ament_target_dependencies(pcl_ros_tf
   ${dependencies}
 )
-target_link_libraries(pcl_ros_tf ${PCL_LIBRARIES})
 
 ### Nodelets
 #
@@ -165,7 +165,7 @@ endif()
 
 install(
   DIRECTORY include/
-  DESTINATION include
+  DESTINATION include/${PROJECT_NAME}
 )
 
 install(
@@ -181,18 +181,18 @@ install(
 #    bag_to_pcd
 #    convert_pcd_to_image
 #    convert_pointcloud_to_image
-  EXPORT export_pcl_ros
+  EXPORT pcl_ros
   RUNTIME DESTINATION bin
   ARCHIVE DESTINATION lib
   LIBRARY DESTINATION lib
-  INCLUDES DESTINATION include
 )
 
 install(DIRECTORY plugins samples
   DESTINATION share/${PROJECT_NAME})
 
-ament_export_include_directories(include)
+# Export old-style CMake variables
+ament_export_include_directories("include/${PROJECT_NAME}")
 ament_export_libraries(pcl_ros_tf)
+ament_export_targets(pcl_ros)
 ament_export_dependencies(${dependencies})
-ament_export_targets(export_pcl_ros HAS_LIBRARY_TARGET)
 ament_package()
-- 
2.34.1

